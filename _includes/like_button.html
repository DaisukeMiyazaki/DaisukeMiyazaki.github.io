<!-- „ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥„Ç®„É™„Ç¢ Start -->
<div class="my-12 flex justify-center">
  <button
    id="like-button"
    class="group flex items-center gap-2 rounded-full border-2 border-gray-200 px-6 py-3 transition-all hover:border-pink-500 hover:bg-pink-50 dark:border-gray-700 dark:hover:border-pink-500 dark:hover:bg-pink-900/20"
    onclick="handleLike()"
  >
    <span class="text-2xl transition-transform group-active:scale-125">üëè</span>
    <span class="font-medium text-gray-600 dark:text-gray-300">
      Like
      <span
        id="like-count"
        class="ml-1 text-lg font-bold text-pink-500 opacity-0 transition-opacity duration-500"
        >0</span
      >
    </span>
  </button>
</div>

<script>
  (function () {
    // API„ÅÆ„Éô„Éº„ÇπURL
    const API_BASE = "https://mdaisukenet.pythonanywhere.com";

    // „Éö„Éº„Ç∏„ÅÆ„É¶„Éã„Éº„ÇØID („Éë„Çπ„ÇíÂà©Áî®)
    const pageId = window.location.pathname;
    const storageKey = `liked_${pageId}`;

    const likeBtn = document.getElementById("like-button");
    const countSpan = document.getElementById("like-count");

    // „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞„Å®„Åó„Å¶ÂÆöÁæ©„Åó„Å™„ÅÑ„Å®HTML„ÅÆonclick„Åã„ÇâÂëº„Åπ„Å™„ÅÑ„Åü„ÇÅ window „Å´Áîü„ÇÑ„Åô
    window.handleLike = async function () {
      if (localStorage.getItem(storageKey)) {
        likeBtn.classList.add("animate-bounce");
        setTimeout(() => likeBtn.classList.remove("animate-bounce"), 500);
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/api/likes`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ page_id: pageId }),
        });

        if (res.ok) {
          const data = await res.json();
          updateCountDisplay(data.count);
          localStorage.setItem(storageKey, "true");
          markAsLiked();
        }
      } catch (error) {
        console.error("Failed to send like:", error);
      }
    };

    async function fetchLikes() {
      try {
        const res = await fetch(
          `${API_BASE}/api/likes?page_id=${encodeURIComponent(pageId)}`,
        );
        if (res.ok) {
          const data = await res.json();
          updateCountDisplay(data.count);
        }
      } catch (error) {
        console.error("Failed to fetch likes:", error);
      }
    }

    function updateCountDisplay(count) {
      if (countSpan) {
        countSpan.innerText = count;
        countSpan.classList.remove("opacity-0");
      }
    }

    function markAsLiked() {
      if (likeBtn) {
        likeBtn.classList.add(
          "border-pink-500",
          "bg-pink-50",
          "dark:bg-pink-900/20",
        );
        const iconSpan = likeBtn.querySelector("span:first-child");
        if (iconSpan) iconSpan.innerText = "üíñ";
      }
    }

    // ÂàùÊúüÂåñ
    if (likeBtn && countSpan) {
      if (localStorage.getItem(storageKey)) {
        markAsLiked();
      }
      fetchLikes();
    }
  })();
</script>
<!-- „ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥„Ç®„É™„Ç¢ End -->
