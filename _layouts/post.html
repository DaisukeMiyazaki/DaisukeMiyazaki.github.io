---
layout: default
---

<div
  class="container mx-auto px-4 py-8 dark:bg-primary-dark dark:text-gray-100"
>
  <header class="mb-8">
    <p class="meta text-sm text-gray-600 dark:text-gray-400">
      {{ page.date | date: "%b %-d, %Y" }}{% if page.author %} â€¢ {{ page.author
      }}{% endif %}{% if page.meta %} â€¢ {{ page.meta }}{% endif %}
    </p>
    <h1 class="title text-3xl font-bold dark:text-primary-light">
      {{ page.title }}
    </h1>
  </header>

  <article class="dark:prose-invert lg:prose-xl">{{ content }}</article>

  <!-- ã„ã„ã­ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ Start -->
  <div class="my-12 flex justify-center">
    <button
      id="like-button"
      class="group flex items-center gap-2 rounded-full border-2 border-gray-200 px-6 py-3 transition-all hover:border-pink-500 hover:bg-pink-50 dark:border-gray-700 dark:hover:border-pink-500 dark:hover:bg-pink-900/20"
      onclick="handleLike()"
    >
      <span class="text-2xl transition-transform group-active:scale-125"
        >ğŸ‘</span
      >
      <span class="font-medium text-gray-600 dark:text-gray-300">
        Like
        <span
          id="like-count"
          class="ml-1 text-lg font-bold text-pink-500 opacity-0 transition-opacity duration-500"
          >0</span
        >
      </span>
    </button>
  </div>

  <script>
    // APIã®ãƒ™ãƒ¼ã‚¹URL (æœ¬ç•ªç”¨)
    const API_BASE = "https://mdaisukenet.pythonanywhere.com";

    // ãƒšãƒ¼ã‚¸ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ID (ãƒ‘ã‚¹ã‚’åˆ©ç”¨)
    // æœ«å°¾ã® /index.html ç­‰ã®æºã‚Œã‚’å¸åã™ã‚‹ãŸã‚ã€pathnameã‚’ãã®ã¾ã¾ã‚­ãƒ¼ã«ã™ã‚‹ã®ãŒç„¡é›£
    const pageId = window.location.pathname;
    const storageKey = `liked_${pageId}`;

    const likeBtn = document.getElementById("like-button");
    const countSpan = document.getElementById("like-count");

    // åˆæœŸè¡¨ç¤ºæ™‚ã«ã‚«ã‚¦ãƒ³ãƒˆã‚’å–å¾—
    async function fetchLikes() {
      try {
        const res = await fetch(
          `${API_BASE}/api/likes?page_id=${encodeURIComponent(pageId)}`,
        );
        if (res.ok) {
          const data = await res.json();
          updateCountDisplay(data.count);
        }
      } catch (error) {
        console.error("Failed to fetch likes:", error);
      }
    }

    // ã„ã„ã­é€ä¿¡
    async function handleLike() {
      // æ—¢ã«ã„ã„ã­æ¸ˆã¿ãªã‚‰ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã ã‘ã—ã¦é€ä¿¡ã—ãªã„
      if (localStorage.getItem(storageKey)) {
        likeBtn.classList.add("animate-bounce");
        setTimeout(() => likeBtn.classList.remove("animate-bounce"), 500);
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/api/likes`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ page_id: pageId }),
        });

        if (res.ok) {
          const data = await res.json();
          updateCountDisplay(data.count);

          // ã„ã„ã­æ¸ˆã¿çŠ¶æ…‹ã‚’ä¿å­˜
          localStorage.setItem(storageKey, "true");
          markAsLiked();
        }
      } catch (error) {
        console.error("Failed to send like:", error);
      }
    }

    function updateCountDisplay(count) {
      countSpan.innerText = count;
      countSpan.classList.remove("opacity-0");
    }

    function markAsLiked() {
      likeBtn.classList.add(
        "border-pink-500",
        "bg-pink-50",
        "dark:bg-pink-900/20",
      );
      // ã‚¢ã‚¤ã‚³ãƒ³ã‚’ãƒãƒ¼ãƒˆã«å¤‰åŒ–ã•ã›ã‚‹
      const iconSpan = likeBtn.querySelector("span:first-child");
      if (iconSpan) iconSpan.innerText = "ğŸ’–";
    }

    // åˆæœŸåŒ–
    if (localStorage.getItem(storageKey)) {
      markAsLiked();
    }
    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«å–å¾—é–‹å§‹
    fetchLikes();
  </script>
  <!-- ã„ã„ã­ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ End -->

  {% assign related = site.related_posts | where:"lang", page.lang %} {% if
  related.size > 0 %}
  <div class="mt-2">
    <h2 class="text-2xl font-semibold">
      {{ site.data.translations['relatedPosts'][page.lang] }}
    </h2>

    <ul class="space-y-4">
      {% for post in related limit:3 %}
      <li>
        <a
          href="{{ post.url }}"
          class="text-primary-link hover:underline dark:text-primary-link-dark dark:hover:text-primary-link-dark"
        >
          {{ post.title }}
          <small class="block text-gray-500 dark:text-gray-400"
            >{{ post.date | date_to_string }}</small
          >
        </a>
      </li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}
</div>
