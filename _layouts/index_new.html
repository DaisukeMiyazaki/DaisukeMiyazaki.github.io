<!doctype html>
<html lang="{{ page.lang }}">
  <head>
    <meta charset="utf-8" />
    {% include head.html %}
    <style>
      .post-slide {
        position: relative;
        height: 100vh;
        width: 100%;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        display: flex;
        align-items: center;
        justify-content: center;
        scroll-snap-align: start;
      }
      
      .post-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0.3), transparent);
        padding: 4rem 2rem 2rem;
        color: white;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
      }
      
      .scroll-container {
        height: 100vh;
        overflow-y: scroll;
        scroll-snap-type: y mandatory;
        scroll-behavior: smooth;
      }
      
      .filter-nav {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 100;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        max-width: 300px;
      }
      
      .filter-btn {
        padding: 8px 16px;
        border-radius: 20px;
        border: none;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.2);
        color: white;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
      }
      
      .filter-btn.active {
        background: rgba(59, 130, 246, 0.8);
        color: white;
      }
      
      .genre-実用 { background: linear-gradient(45deg, #667eea, #764ba2); }
      .genre-短編小説 { background: linear-gradient(45deg, #f093fb, #f5576c); }
      .genre-エッセイ { background: linear-gradient(45deg, #4facfe, #00f2fe); }
      .genre-work { background: linear-gradient(45deg, #43e97b, #38f9d7); }
      .genre-practical { background: linear-gradient(45deg, #fa709a, #fee140); }
      .genre-short-story { background: linear-gradient(45deg, #a8edea, #fed6e3); }
      .genre-default { background: linear-gradient(45deg, #d299c2, #fef9d7); }
      
      .post-meta {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-bottom: 0.5rem;
      }
      
      .post-title {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 1rem 0;
        line-height: 1.2;
      }
      
      .post-excerpt {
        font-size: 1.1rem;
        line-height: 1.6;
        max-width: 600px;
      }
      
      .post-link {
        display: inline-block;
        margin-top: 1rem;
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        color: white;
        text-decoration: none;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }
      
      .post-link:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }
      
      .scroll-indicator {
        position: fixed;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        z-index: 50;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      
      .scroll-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        cursor: pointer;
        transition: all 0.3s ease;
      }
      
      .scroll-dot.active {
        background: rgba(255, 255, 255, 0.8);
        transform: scale(1.2);
      }
      
      @media (max-width: 768px) {
        .filter-nav {
          top: 10px;
          right: 10px;
          left: 10px;
          max-width: none;
        }
        
        .post-title {
          font-size: 2rem;
        }
        
        .post-overlay {
          padding: 2rem 1rem 1rem;
        }
      }
    </style>
  </head>
  <body class="primary-light text-gray-900 dark:bg-primary-dark dark:text-gray-100">
    <div class="filter-nav">
      <button class="filter-btn active" data-genre="all">
        すべて
      </button>
      <button class="filter-btn" data-genre="実用">
        実用
      </button>
      <button class="filter-btn" data-genre="短編小説">
        短編小説
      </button>
      <button class="filter-btn" data-genre="エッセイ">
        エッセイ
      </button>
      <button class="filter-btn" data-genre="work">
        work
      </button>
      <button class="filter-btn" data-genre="practical">
        practical
      </button>
      <button class="filter-btn" data-genre="short-story">
        short-story
      </button>
    </div>
    
    <div class="scroll-indicator" id="scroll-indicator">
      <!-- Dots will be generated by JavaScript -->
    </div>
    
    <div class="scroll-container" id="scroll-container">
      {% assign posts = site.posts | where:"lang", page.lang %}
      {% for post in posts %}
        {% assign post_image = "" %}
        {% assign post_class = "genre-default" %}
        
        {% comment %} Extract first image from post content {% endcomment %}
        {% if post.content contains '<img' %}
          {% assign img_start = post.content | split: '<img' | first %}
          {% assign img_part = post.content | split: '<img' | last %}
          {% assign src_part = img_part | split: 'src="' | last %}
          {% assign post_image = src_part | split: '"' | first %}
        {% endif %}
        
        {% comment %} Set genre class {% endcomment %}
        {% if post.genre %}
          {% assign post_class = post.genre | prepend: "genre-" %}
        {% endif %}
        
        <div class="post-slide {{ post_class }}" 
             data-genre="{{ post.genre }}"
             data-date="{{ post.date | date_to_xmlschema }}"
             {% if post_image != "" %}
               style="background-image: url('{{ post_image }}');"
             {% endif %}>
          
          <div class="post-overlay">
            <div class="post-meta">
              <span>{{ post.date | date_to_string }}</span>
              <span class="ml-4">#{{ post.genre }}</span>
            </div>
            
            <h1 class="post-title">{{ post.title }}</h1>
            
            <div class="post-excerpt">{{ post.excerpt }}</div>
            
            <a href="{{ post.url }}" class="post-link">
              続きを読む →
            </a>
          </div>
        </div>
      {% endfor %}
      
      {% for work in site.data.works %}
        <div class="post-slide genre-work" 
             data-genre="work"
             data-date="{{ work.jp.start_at | date: '%Y-%m-%d' }}">
          
          <div class="post-overlay">
            <div class="post-meta">
              <span>{{ work.jp.start_at }} ~ {{ work.jp.end_at }}</span>
              <span class="ml-4">#work</span>
            </div>
            
            <h1 class="post-title">{{ work.jp.title }}</h1>
            
            <div class="post-excerpt">{{ work.jp.short }}</div>
            
            <a href="{{ work.jp.site_link }}" class="post-link" target="_blank">
              プロジェクトを見る →
            </a>
          </div>
        </div>
      {% endfor %}
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const filterButtons = document.querySelectorAll(".filter-btn");
        const scrollContainer = document.getElementById("scroll-container");
        const scrollIndicator = document.getElementById("scroll-indicator");
        const postSlides = Array.from(document.querySelectorAll(".post-slide"));
        
        // Sort slides by date
        postSlides.sort((a, b) => new Date(b.dataset.date) - new Date(a.dataset.date));
        
        // Clear container and re-append sorted slides
        scrollContainer.innerHTML = "";
        postSlides.forEach(slide => scrollContainer.appendChild(slide));
        
        // Generate scroll indicator dots
        function generateScrollDots() {
          scrollIndicator.innerHTML = "";
          const visibleSlides = postSlides.filter(slide => slide.style.display !== "none");
          
          visibleSlides.forEach((slide, index) => {
            const dot = document.createElement("div");
            dot.className = "scroll-dot";
            dot.addEventListener("click", () => {
              slide.scrollIntoView({ behavior: "smooth" });
            });
            scrollIndicator.appendChild(dot);
          });
        }
        
        // Update active dot based on scroll position
        function updateActiveDot() {
          const dots = document.querySelectorAll(".scroll-dot");
          const visibleSlides = postSlides.filter(slide => slide.style.display !== "none");
          
          let activeIndex = 0;
          const scrollTop = scrollContainer.scrollTop;
          const containerHeight = scrollContainer.clientHeight;
          
          for (let i = 0; i < visibleSlides.length; i++) {
            const slide = visibleSlides[i];
            const slideTop = slide.offsetTop;
            const slideBottom = slideTop + slide.offsetHeight;
            
            if (scrollTop >= slideTop - containerHeight/2 && scrollTop < slideBottom - containerHeight/2) {
              activeIndex = i;
              break;
            }
          }
          
          dots.forEach((dot, index) => {
            dot.classList.toggle("active", index === activeIndex);
          });
        }
        
        // Filter functionality
        filterButtons.forEach(button => {
          button.addEventListener("click", function () {
            const genre = this.dataset.genre;
            
            // Update active button
            filterButtons.forEach(btn => btn.classList.remove("active"));
            this.classList.add("active");
            
            // Filter slides
            postSlides.forEach(slide => {
              const slideGenre = slide.dataset.genre;
              if (genre === "all" || slideGenre === genre) {
                slide.style.display = "block";
              } else {
                slide.style.display = "none";
              }
            });
            
            // Regenerate dots and scroll to top
            generateScrollDots();
            scrollContainer.scrollTop = 0;
          });
        });
        
        // Scroll event listener
        scrollContainer.addEventListener("scroll", updateActiveDot);
        
        // Initialize
        generateScrollDots();
        updateActiveDot();
      });
    </script>
  </body>
</html> 